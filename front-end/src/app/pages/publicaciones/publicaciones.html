<div class="container">
  <h1>Publicaciones</h1>

  <div class="crear-publicacion">
    <h3>¿Qué estás pensando?</h3>
    <form [formGroup]="form" (ngSubmit)="crearPublicacion()">
      
      <div class="form-group">
        <input type="text" placeholder="Título" formControlName="titulo">
      </div>
      
      <div class="form-group">
        <textarea placeholder="Escribe tu mensaje aquí..." rows="3" formControlName="mensaje"></textarea>
      </div>

      <div class="form-group">
        <label for="fileInput">Imagen (Opcional): </label>
        <input type="file" id="fileInput" (change)="onFileSelected($event)" accept="image/*">
      </div>

      <button type="submit" class="btn-publicar" [disabled]="form.invalid || isSubmitting()">
        @if (isSubmitting()) {
          Publicando...
        } @else {
          Publicar
        }
      </button>
    </form>
  </div>
  <hr>
  <div class="filtros">
    <label>Ordenar por: </label>
    <select (change)="cambiarOrden($any($event.target).value === 'fecha' ? 'fecha' : 'likes')" [value]="orden()">
      <option value="fecha">Más recientes</option>
      <option value="likes">Más populares</option>
    </select>
  </div>

  @if (publicaciones().length > 0) {
    <div class="publicaciones-container">
      @for (pub of publicaciones(); track pub._id) {
        <app-publicacion 
          [publicacion]="pub" 
          [currentUserId]="currentUserId()"
          (onLike)="onLike($event)"
          (onUnlike)="onUnlike($event)"
          (onDelete)="onDelete($event)"
        />
      }
    </div>
  } @else {
    <p>No hay publicaciones para mostrar.</p>
  }

  <div class="paginacion">
    <button (click)="paginar(-limit())" [disabled]="offset() === 0">Anterior</button>
    <span>
      Mostrando {{ offset() + 1 }} - {{ offset() + publicaciones().length }} de {{ totalPublicaciones() }}
    </span>
    <button (click)="paginar(limit())" [disabled]="offset() + limit() >= totalPublicaciones()">Siguiente</button>
  </div>

</div>